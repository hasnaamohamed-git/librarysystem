<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Profile - Library Management System</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* ===== RESET & BASE ===== */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      }

      body {
        background-color: #f0e8d8;
        color: #333;
        line-height: 1.6;
        min-height: 100vh;
      }

      /* ===== HEADER & NAVIGATION ===== */
      .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 30px;
        background-color: #2c3e50;
        color: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        flex-wrap: wrap;
      }

      .logo {
        font-size: 24px;
        font-weight: bold;
        color: white;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .nav-links {
        display: flex;
        gap: 15px;
        font-size: 14px;
        align-items: center;
        flex-wrap: wrap;
      }

      .nav-links a,
      .nav-links button {
        text-decoration: none;
        color: white;
        background: none;
        border: none;
        cursor: pointer;
        font-size: 14px;
        padding: 8px 12px;
        border-radius: 5px;
        transition: all 0.3s;
        white-space: nowrap;
      }

      .nav-links a:hover,
      .nav-links button:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: #e67e22;
      }

      .nav-links a.active {
        background-color: #e67e22;
        color: white;
        font-weight: bold;
      }

      .user-role-badge {
        padding: 3px 10px;
        border-radius: 12px;
        font-size: 12px;
        font-weight: bold;
        margin-left: 5px;
      }

      .role-user {
        background-color: #27ae60;
        color: white;
      }

      .role-admin {
        background-color: #e74c3c;
        color: white;
      }

      .role-librarian {
        background-color: #3498db;
        color: white;
      }

      /* ===== PROFILE CONTENT ===== */
      .profile-container {
        max-width: 1200px;
        margin: 30px auto;
        padding: 0 20px;
      }

      .profile-card {
        background: white;
        border-radius: 15px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        padding: 40px;
        margin-bottom: 30px;
      }

      .profile-header {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 40px;
        text-align: center;
      }

      .profile-avatar {
        width: 150px;
        height: 150px;
        border-radius: 50%;
        background: linear-gradient(135deg, #e67e22, #d35400);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 60px;
        color: white;
        font-weight: bold;
        margin-bottom: 20px;
        border: 5px solid #f0e8d8;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .profile-name {
        font-size: 32px;
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .profile-role-badge {
        display: inline-block;
        padding: 8px 20px;
        border-radius: 25px;
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 10px;
      }

      .profile-info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
      }

      .info-card {
        background: #f8f9fa;
        padding: 25px;
        border-radius: 10px;
        border-left: 4px solid #e67e22;
        transition: all 0.3s;
      }

      .info-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      }

      .info-label {
        font-size: 14px;
        color: #7f8c8d;
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      .info-value {
        font-size: 18px;
        color: #2c3e50;
        font-weight: 600;
      }

      .info-icon {
        font-size: 24px;
        color: #e67e22;
        margin-bottom: 15px;
      }

      /* ===== ROLE-SPECIFIC SECTIONS ===== */
      .role-section {
        margin-top: 40px;
        padding-top: 30px;
        border-top: 2px solid #eee;
      }

      .section-title {
        font-size: 24px;
        color: #2c3e50;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section-title i {
        color: #e67e22;
      }

      .dashboard-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
      }

      .dashboard-card {
        background: white;
        border-radius: 10px;
        padding: 25px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        transition: all 0.3s;
        border: 1px solid #eee;
      }

      .dashboard-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
      }

      .dashboard-card h3 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 18px;
      }

      .dashboard-card p {
        color: #7f8c8d;
        margin-bottom: 20px;
        font-size: 14px;
      }

      .action-btn {
        display: inline-block;
        padding: 10px 20px;
        background-color: #3498db;
        color: white;
        text-decoration: none;
        border-radius: 6px;
        font-weight: 600;
        transition: all 0.3s;
        border: none;
        cursor: pointer;
        font-size: 14px;
      }

      .action-btn:hover {
        background-color: #2980b9;
      }

      .btn-admin {
        background-color: #e74c3c;
      }

      .btn-admin:hover {
        background-color: #c0392b;
      }

      .btn-librarian {
        background-color: #3498db;
      }

      .btn-librarian:hover {
        background-color: #2980b9;
      }

      .btn-user {
        background-color: #27ae60;
      }

      .btn-user:hover {
        background-color: #219653;
      }

      /* ===== BOOKS SECTION FOR USER ===== */
      .books-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
      }

      .book-card {
        background: white;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        transition: all 0.3s;
        border: 1px solid #eee;
      }

      .book-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .book-card h4 {
        color: #2c3e50;
        margin-bottom: 8px;
        font-size: 16px;
      }

      .book-card p {
        color: #7f8c8d;
        font-size: 14px;
        margin-bottom: 5px;
      }

      /* ===== STATS ===== */
      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        margin-top: 20px;
      }

      .stat-card {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .stat-number {
        font-size: 24px;
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 5px;
      }

      .stat-label {
        font-size: 12px;
        color: #7f8c8d;
        text-transform: uppercase;
      }

      /* ===== FOOTER ===== */
      .footer {
        text-align: center;
        padding: 20px;
        color: #7f8c8d;
        font-size: 14px;
        margin-top: 50px;
        border-top: 1px solid #eee;
      }

      /* ===== RESPONSIVE DESIGN ===== */
      @media (max-width: 768px) {
        .header {
          flex-direction: column;
          gap: 15px;
          padding: 15px;
        }

        .nav-links {
          justify-content: center;
          width: 100%;
          gap: 10px;
        }

        .profile-card {
          padding: 20px;
        }

        .profile-avatar {
          width: 120px;
          height: 120px;
          font-size: 50px;
        }

        .profile-name {
          font-size: 24px;
        }

        .dashboard-cards {
          grid-template-columns: 1fr;
        }

        .profile-info-grid {
          grid-template-columns: 1fr;
        }
      }

      @media (max-width: 480px) {
        .nav-links {
          font-size: 12px;
        }

        .nav-links a,
        .nav-links button {
          padding: 6px 8px;
        }

        .profile-avatar {
          width: 100px;
          height: 100px;
          font-size: 40px;
        }

        .books-grid {
          grid-template-columns: 1fr;
        }
      }

      /* ===== UTILITIES ===== */
      .hidden {
        display: none !important;
      }

      .loading {
        text-align: center;
        padding: 50px;
        font-size: 18px;
        color: #7f8c8d;
      }

      .error-message {
        background-color: #ffeaea;
        color: #e74c3c;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        margin: 20px;
      }
    </style>
  </head>
  <body>
    <!-- HEADER WITH DYNAMIC NAVIGATION -->
    <div class="header">
      <div class="logo">
        <svg
          width="32"
          height="32"
          viewBox="0 0 32 32"
          fill="none"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            d="M24 8H8V24H24V8Z"
            stroke="white"
            stroke-width="2"
            fill="none"
          />
          <path d="M8 12H24" stroke="white" stroke-width="2" fill="none" />
          <path d="M8 16H20" stroke="white" stroke-width="2" fill="none" />
          <path d="M8 20H16" stroke="white" stroke-width="2" fill="none" />
        </svg>
        LIBRARY
      </div>
      <nav class="nav-links" id="mainNavigation">
        <!-- سيتم ملؤه ديناميكياً حسب دور المستخدم -->
      </nav>
    </div>

    <!-- MAIN CONTENT -->
    <div class="profile-container">
      <div id="loading" class="loading">
        <p>Loading profile information...</p>
      </div>

      <!-- ERROR MESSAGE -->
      <div id="errorContainer" class="error-message hidden">
        <h3>No User Found</h3>
        <p>Please login first to view your profile.</p>
        <button
          onclick="window.location.href='index.html'"
          class="action-btn"
          style="margin-top: 15px"
        >
          Go to Login
        </button>
      </div>

      <!-- PROFILE CARD -->
      <div id="profileCard" class="profile-card hidden">
        <div class="profile-header">
          <div class="profile-avatar" id="userAvatar">
            <!-- سيتم ملؤه بـ JS -->
          </div>
          <h1 class="profile-name" id="userName"></h1>
          <div class="profile-role-badge" id="userRoleBadge"></div>
        </div>

        <div class="profile-info-grid">
          <div class="info-card">
            <div class="info-icon">
              <i class="fas fa-envelope"></i>
            </div>
            <div class="info-label">Email Address</div>
            <div class="info-value" id="userEmail"></div>
          </div>

          <div class="info-card">
            <div class="info-icon">
              <i class="fas fa-phone"></i>
            </div>
            <div class="info-label">Phone Number</div>
            <div class="info-value" id="userPhone"></div>
          </div>

          <div class="info-card">
            <div class="info-icon">
              <i class="fas fa-calendar-alt"></i>
            </div>
            <div class="info-label">Member Since</div>
            <div class="info-value" id="memberSince"></div>
          </div>

          <!-- تم إزالة قسم User ID كما طلبت -->
        </div>

        <!-- ===== USER-SPECIFIC SECTION ===== -->
        <div id="userSection" class="role-section hidden">
          <h2 class="section-title">
            <i class="fas fa-book-reader"></i> Member Dashboard
          </h2>
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-number" id="borrowedBooks">0</div>
              <div class="stat-label">Books Borrowed</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="reservedBooks">0</div>
              <div class="stat-label">Books Reserved</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="readBooks">0</div>
              <div class="stat-label">Books Read</div>
            </div>
            <div class="stat-card">
              <div class="stat-number" id="quotesCount">0</div>
              <div class="stat-label">Quotes Saved</div>
            </div>
            <!-- بطاقة الغرامات المضافة -->
            <div class="stat-card">
              <div class="stat-number" id="finesAmount">0</div>
              <div class="stat-label">Fines (USD)</div>
            </div>
            <!-- بطاقة أيام التأخير المضافة -->
            <div class="stat-card">
              <div class="stat-number" id="delayDays">0</div>
              <div class="stat-label">Delay Days</div>
            </div>
          </div>

          <div style="margin-top: 30px">
            <h3 class="section-title">
              <i class="fas fa-book-open"></i> Recently Added Books
            </h3>
            <div class="books-grid" id="userBooksGrid">
              <!-- سيتم ملؤه بـ JS -->
            </div>
          </div>
        </div>

        <!-- ===== ADMIN-SPECIFIC SECTION ===== -->
        <div id="adminSection" class="role-section hidden">
          <h2 class="section-title">
            <i class="fas fa-crown"></i> Administrator Dashboard
          </h2>
          <div class="dashboard-cards">
            <div class="dashboard-card">
              <h3>Manage Books</h3>
              <p>Add, edit, or remove books from the library catalog.</p>
              <button
                class="action-btn btn-admin"
                onclick="navigateTo('manage-books')"
              >
                <i class="fas fa-book"></i> Go to Books Management
              </button>
            </div>
            <div class="dashboard-card">
              <h3>Manage Authors</h3>
              <p>Manage author profiles and their publications.</p>
              <button
                class="action-btn btn-admin"
                onclick="navigateTo('manage-authors')"
              >
                <i class="fas fa-user-edit"></i> Go to Authors Management
              </button>
            </div>
            <div class="dashboard-card">
              <h3>Manage Members</h3>
              <p>View, add, or remove library members.</p>
              <button
                class="action-btn btn-admin"
                onclick="navigateTo('manage-members')"
              >
                <i class="fas fa-users"></i> Go to Members Management
              </button>
            </div>
            <div class="dashboard-card">
              <h3>Manage Librarians</h3>
              <p>Add or remove librarian accounts.</p>
              <button
                class="action-btn btn-admin"
                onclick="navigateTo('manage-librarians')"
              >
                <i class="fas fa-user-shield"></i> Go to Librarians Management
              </button>
            </div>
            <div class="dashboard-card">
              <h3>Admin Dashboard</h3>
              <p>View system statistics and reports.</p>
              <button
                class="action-btn btn-admin"
                onclick="navigateTo('admin-dashboard')"
              >
                <i class="fas fa-chart-bar"></i> View Dashboard
              </button>
            </div>
            <div class="dashboard-card">
              <h3>Chat Bot</h3>
              <p>Configure and manage the library chat assistant.</p>
              <button
                class="action-btn btn-admin"
                onclick="navigateTo('chat-bot')"
              >
                <i class="fas fa-robot"></i> Manage Chat Bot
              </button>
            </div>
          </div>
        </div>

        <!-- ===== LIBRARIAN-SPECIFIC SECTION ===== -->
        <div id="librarianSection" class="role-section hidden">
          <h2 class="section-title">
            <i class="fas fa-user-shield"></i> Librarian Dashboard
          </h2>
          <div class="dashboard-cards">
            <div class="dashboard-card">
              <h3>Manage Books</h3>
              <p>Add, edit, or remove books from the library.</p>
              <button
                class="action-btn btn-librarian"
                onclick="navigateTo('manage-books')"
              >
                <i class="fas fa-book"></i> Go to Books Management
              </button>
            </div>
            <div class="dashboard-card">
              <h3>Manage Authors</h3>
              <p>Update author information and books.</p>
              <button
                class="action-btn btn-librarian"
                onclick="navigateTo('manage-authors')"
              >
                <i class="fas fa-user-edit"></i> Go to Authors Management
              </button>
            </div>
            <div class="dashboard-card">
              <h3>Manage Members</h3>
              <p>Approve new members and manage accounts.</p>
              <button
                class="action-btn btn-librarian"
                onclick="navigateTo('manage-members')"
              >
                <i class="fas fa-users"></i> Go to Members Management
              </button>
            </div>
          </div>
        </div>

        <!-- ACTION BUTTONS -->
        <div
          style="
            display: flex;
            gap: 15px;
            margin-top: 40px;
            justify-content: center;
            flex-wrap: wrap;
          "
        >
          <button class="action-btn btn-user" id="editProfileBtn">
            <i class="fas fa-edit"></i> Edit Profile
          </button>
          <button
            class="action-btn"
            style="background-color: #95a5a6"
            id="changePasswordBtn"
          >
            <i class="fas fa-key"></i> Change Password
          </button>
          <button
            class="action-btn"
            style="background-color: #e74c3c"
            id="logoutBtn"
          >
            <i class="fas fa-sign-out-alt"></i> Logout
          </button>
        </div>
      </div>
    </div>

    <!-- FOOTER -->
    <div class="footer">
      <p>&copy; 2025 Library Management System. All rights reserved.</p>
    </div>

    <script>
      // بيانات التطبيق
      const App = {
        currentUser: null,
        userStats: {
          borrowedBooks: 3,
          reservedBooks: 2,
          readBooks: 12,
          quotesCount: 5,
          finesAmount: 0,  // إضافة جديدة: الغرامات
          delayDays: 0     // إضافة جديدة: أيام التأخير
        },

        // روابط التنقل حسب الدور
        navigationLinks: {
          // روابط عامة لجميع المستخدمين
          common: [
            {
              name: "My Profile",
              href: "profile.html",
              icon: "fas fa-user",
              active: true,
            },
          ],

          // روابط خاصة بـ User
          user: [
            { name: "My Books", href: "books_user.html", icon: "fas fa-book" },
            { name: "Authors", href: "Authors.html", icon: "fas fa-user-edit" },
            { name: "Quotes", href: "quotes.html", icon: "fas fa-quote-right" },
             {
              name: "Chat bot",
              href: "chatbot.html",
              icon: "fas fa-robot",
            }
          ],

          // روابط خاصة بـ Admin
          admin: [
            {
              name: "Manage Books",
              href: "manageBooks.html",
              icon: "fas fa-book",
            },
            {
              name: "Manage Authors",
              href: "manageAuthors.html",
              icon: "fas fa-user-edit",
            },
            {
              name: "Manage Members & Librarians",
              href: "ManageMembers&Librarians.html",
              icon: "fas fa-user-shield",
            },
            {
              name: "Manage Quotes",
              href: "manage quotes.html",
              icon: "fas fa-user-edit",
            },
            {
              name: "Dashboard & Chat Bot",
              href: "AD with chatbot.html",
              icon: "fas fa-chart-bar",
            },
             {
              name: "Chat bot",
              href: "chatbot.html",
              icon: "fas fa-robot",
            }
          ],

          // روابط خاصة بـ Librarian
          librarian: [
            {
              name: "Manage Books",
              href: "manageBooks.html",
              icon: "fas fa-book",
            },
            {
              name: "Manage Authors",
              href: "manageAuthors.html",
              icon: "fas fa-user-edit",
            },
            {
              name: "Manage Quotes",
              href: "manage quotes.html",
              icon: "fas fa-user-edit",
            },
             {
              name: "Manage Members",
              href: "member_mangement.html",
              icon: "fas fa-user-edit",
            },
            {
              name: "Chat bot",
              href: "chatbot.html",
              icon: "fas fa-robot",
            }
            
          ],
        },

        // كتب عشوائية للعرض
        sampleBooks: [
          {
            title: "The Great Gatsby",
            author: "F. Scott Fitzgerald",
            genre: "Classic",
            year: 1925,
          },
          {
            title: "To Kill a Mockingbird",
            author: "Harper Lee",
            genre: "Fiction",
            year: 1960,
          },
          {
            title: "1984",
            author: "George Orwell",
            genre: "Dystopian",
            year: 1949,
          },
          {
            title: "Pride and Prejudice",
            author: "Jane Austen",
            genre: "Romance",
            year: 1813,
          },
          {
            title: "The Catcher in the Rye",
            author: "J.D. Salinger",
            genre: "Fiction",
            year: 1951,
          },
          {
            title: "The Hobbit",
            author: "J.R.R. Tolkien",
            genre: "Fantasy",
            year: 1937,
          },
        ],

        // تهيئة التطبيق
        init: function () {
          this.loadUserData();
          this.setupNavigation();
          this.displayProfile();
          this.setupEventListeners();
        },

        // تحميل بيانات المستخدم
        loadUserData: function () {
          const userData = JSON.parse(localStorage.getItem("currentUser"));
          const loading = document.getElementById("loading");
          const errorContainer = document.getElementById("errorContainer");
          const profileCard = document.getElementById("profileCard");

          if (!userData) {
            loading.classList.add("hidden");
            errorContainer.classList.remove("hidden");
            return;
          }

          this.currentUser = userData;
          loading.classList.add("hidden");
          profileCard.classList.remove("hidden");
        },

        // إعداد شريط التنقل حسب الدور
        setupNavigation: function () {
          const navContainer = document.getElementById("mainNavigation");

          if (!this.currentUser) return;

          // روابط عامة
          const links = [...this.navigationLinks.common];

          // إضافة روابط حسب الدور
          switch (this.currentUser.role) {
            case "admin":
              links.push(...this.navigationLinks.admin);
              break;
            case "librarian":
              links.push(...this.navigationLinks.librarian);
              break;
            case "user":
            default:
              links.push(...this.navigationLinks.user);
              break;
          }

          // إضافة زر تسجيل الخروج
          links.push({
            name: "Logout",
            href: "#",
            icon: "fas fa-sign-out-alt",
            action: "logout",
          });

          // بناء شريط التنقل
          navContainer.innerHTML = links
            .map((link) => {
              if (link.action === "logout") {
                return `<button class="sign-up-btn" onclick="App.logout()">
                            <i class="${link.icon}"></i> ${link.name}
                        </button>`;
              }

              const activeClass = link.active ? "active" : "";
              return `<a href="${link.href}" class="${activeClass}">
                        <i class="${link.icon}"></i> ${link.name}
                    </a>`;
            })
            .join("");
        },

        // عرض بيانات البروفايل
        displayProfile: function () {
          if (!this.currentUser) return;

          // استخراج أول حرف من الاسم
          const initial = this.currentUser.fullName
            ? this.currentUser.fullName.charAt(0).toUpperCase()
            : "U";

          // تحديث العناصر
          document.getElementById("userAvatar").textContent = initial;
          document.getElementById("userName").textContent =
            this.currentUser.fullName || "User";
          document.getElementById("userEmail").textContent =
            this.currentUser.email || "No email";
          document.getElementById("userPhone").textContent =
            this.currentUser.phoneNumber || "No phone";
          
       

          // تحديث الدور مع تلوين
          const roleBadge = document.getElementById("userRoleBadge");
          let roleText = "";
          let roleClass = "";

          switch (this.currentUser.role) {
            case "admin":
              roleText = "Administrator";
              roleClass = "role-admin";
              roleBadge.style.backgroundColor = "#e74c3c";
              break;
            case "librarian":
              roleText = "Librarian";
              roleClass = "role-librarian";
              roleBadge.style.backgroundColor = "#3498db";
              break;
            case "user":
            default:
              roleText = "Library Member";
              roleClass = "role-user";
              roleBadge.style.backgroundColor = "#27ae60";
              break;
          }

          roleBadge.textContent = roleText;
          roleBadge.className = "profile-role-badge " + roleClass;

          // تحديث التاريخ
          const joinDate =
            this.currentUser.joinDate || new Date().toISOString();
          document.getElementById("memberSince").textContent = new Date(
            joinDate
          ).toLocaleDateString("en-US", {
            year: "numeric",
            month: "long",
            day: "numeric",
          });

          // عرض القسم المناسب حسب الدور
          this.showRoleSection();

          // إذا كان مستخدم عادي، عرض الكتب والإحصائيات
          if (this.currentUser.role === "user") {
            this.displayUserBooks();
            this.displayUserStats();
          }
        },

        // عرض القسم المناسب حسب الدور
        showRoleSection: function () {
          // إخفاء جميع الأقسام أولاً
          document.getElementById("userSection").classList.add("hidden");
          document.getElementById("adminSection").classList.add("hidden");
          document.getElementById("librarianSection").classList.add("hidden");

          // عرض القسم المناسب
          switch (this.currentUser.role) {
            case "admin":
              document
                .getElementById("adminSection")
                .classList.remove("hidden");
              break;
            case "librarian":
              document
                .getElementById("librarianSection")
                .classList.remove("hidden");
              break;
            case "user":
            default:
              document.getElementById("userSection").classList.remove("hidden");
              break;
          }
        },

        // عرض كتب المستخدم
        displayUserBooks: function () {
          const booksGrid = document.getElementById("userBooksGrid");
          booksGrid.innerHTML = "";

          this.sampleBooks.slice(0, 4).forEach((book) => {
            const bookCard = document.createElement("div");
            bookCard.className = "book-card";
            bookCard.innerHTML = `
                        <h4>${book.title}</h4>
                        <p><i class="fas fa-user-pen"></i> ${book.author}</p>
                        <p><i class="fas fa-tag"></i> ${book.genre}</p>
                        <p><i class="fas fa-calendar"></i> ${book.year}</p>
                    `;
            booksGrid.appendChild(bookCard);
          });
        },

        // عرض إحصائيات المستخدم
        displayUserStats: function () {
          document.getElementById("borrowedBooks").textContent =
            this.userStats.borrowedBooks;
          document.getElementById("reservedBooks").textContent =
            this.userStats.reservedBooks;
          document.getElementById("readBooks").textContent =
            this.userStats.readBooks;
          document.getElementById("quotesCount").textContent =
            this.userStats.quotesCount;
          document.getElementById("finesAmount").textContent =
            this.userStats.finesAmount; // إضافة الغرامات
          document.getElementById("delayDays").textContent =
            this.userStats.delayDays; // إضافة أيام التأخير
        },

        // إعداد مستمعي الأحداث
        setupEventListeners: function () {
          // زر تعديل البروفايل
          document
            .getElementById("editProfileBtn")
            .addEventListener("click", () => {
              this.editProfile();
            });

          // زر تغيير كلمة المرور
          document
            .getElementById("changePasswordBtn")
            .addEventListener("click", () => {
              this.changePassword();
            });

          // زر تسجيل الخروج
          document.getElementById("logoutBtn").addEventListener("click", () => {
            this.logout();
          });

          // تأثير عند تمرير الماوس على الصورة الرمزية
          document
            .getElementById("userAvatar")
            .addEventListener("mouseenter", function () {
              this.style.transform = "scale(1.1) rotate(5deg)";
            });

          document
            .getElementById("userAvatar")
            .addEventListener("mouseleave", function () {
              this.style.transform = "scale(1) rotate(0deg)";
            });
        },

        // دالة تعديل البروفايل
        editProfile: function () {
          const newName = prompt(
            "Enter new full name:",
            this.currentUser.fullName
          );
          const newPhone = prompt(
            "Enter new phone number:",
            this.currentUser.phoneNumber
          );

          if (newName !== null) {
            this.currentUser.fullName = newName;
            document.getElementById("userName").textContent = newName;
            document.getElementById("userAvatar").textContent = newName
              .charAt(0)
              .toUpperCase();
          }

          if (newPhone !== null) {
            this.currentUser.phoneNumber = newPhone;
            document.getElementById("userPhone").textContent = newPhone;
          }

          // تحديث localStorage
          localStorage.setItem("currentUser", JSON.stringify(this.currentUser));

          // تحديث قاعدة البيانات (إذا كانت موجودة)
          if (this.currentUser.role === "user") {
            const users = JSON.parse(localStorage.getItem("users")) || [];
            const userIndex = users.findIndex(
              (u) => u.email === this.currentUser.email
            );
            if (userIndex !== -1) {
              users[userIndex] = this.currentUser;
              localStorage.setItem("users", JSON.stringify(users));
            }
          }

          alert("Profile updated successfully!");
        },

        // دالة تغيير كلمة المرور
        changePassword: function () {
          const oldPass = prompt("Enter current password:");
          if (!oldPass) return;

          // التحقق من كلمة المرور القديمة
          let isValid = false;

          if (
            this.currentUser.email === "admin@admin.com" &&
            oldPass === "password123"
          ) {
            isValid = true;
          } else if (
            this.currentUser.email === "librarian@library.com" &&
            oldPass === "libpass123"
          ) {
            isValid = true;
          } else if (this.currentUser.role === "user") {
            const users = JSON.parse(localStorage.getItem("users")) || [];
            const user = users.find((u) => u.email === this.currentUser.email);
            if (user && user.password === oldPass) {
              isValid = true;
            }
          }

          if (!isValid) {
            alert("Incorrect current password!");
            return;
          }

          const newPass = prompt("Enter new password:");
          const confirmPass = prompt("Confirm new password:");

          if (newPass !== confirmPass) {
            alert("Passwords do not match!");
            return;
          }

          if (newPass.length < 6) {
            alert("Password must be at least 6 characters!");
            return;
          }

          // تحديث كلمة المرور
          if (this.currentUser.role === "user") {
            const users = JSON.parse(localStorage.getItem("users")) || [];
            const userIndex = users.findIndex(
              (u) => u.email === this.currentUser.email
            );
            if (userIndex !== -1) {
              users[userIndex].password = newPass;
              localStorage.setItem("users", JSON.stringify(users));
              this.currentUser.password = newPass;
            }
          }

          // تحديث currentUser
          this.currentUser.password = newPass;
          localStorage.setItem("currentUser", JSON.stringify(this.currentUser));

          alert("Password changed successfully!");
        },

        // دالة تسجيل الخروج
        logout: function () {
          if (confirm("Are you sure you want to logout?")) {
            localStorage.removeItem("currentUser");
            window.location.href = "index.html";
          }
        },

        // دالة للتنقل (يمكنك توسيعها لاحقاً)
        navigateTo: function (page) {
          alert(
            `Navigating to ${page} (This feature will be implemented in the next phase)`
          );
          // يمكنك إضافة window.location.href = page + '.html'; لاحقاً
        },
      };

      // بدء التطبيق عند تحميل الصفحة
      document.addEventListener("DOMContentLoaded", function () {
        App.init();
      });
    </script>
  </body>
</html>
